---
title: 黑苹果入门完全指南
date: 2020-2-14 20:36:00
categories: 
	- [Hackintosh]
	#- [cate2]
	#...
tags: 
	- macOS
	- Hackintosh
	#...

#If you need a thumbnail photo for your post, delete the well number below and finish the directory.
thumbnail: https://astrobear.top/resource/astroblog/thumbnail/hpenvy13hackintosh.jpeg

#If you need to customize your excerpt, delete the well number below and input something. You can also input <!-- more --> in your article to divide the excerpt and other contents.
excerpt: 震惊！黑苹果的背后居然有着这些不为人知的秘密！

#You can begin to input your article below now.

---

### 关于黑苹果

欢迎步入黑苹果的世界！众所周知，Mac因其独特的macOS系统在众多Windows电脑中独树一帜。macOS具有许多与Windows不同的特性和优点（当然，也有不足），而且有些软件在macOS上的优化会比Windows更好或者只支持macOS平台。这就是为什么Mac在市场上一直有着广泛的需求的根本原因——即macOS的独特性。由于苹果的封闭性策略，macOS在正常情况下只能安装在Mac上。而黑苹果的出现，给广大对macOS有需求的人们提供了一个新的选择——你再也不需要为了一个系统去购买在同等硬件或性能条件下价格更为昂贵的电脑了。

黑苹果，意思就是安装有macOS的，可以正常工作的非Mac的电脑，也可以指为非Mac的电脑安装macOS的行为，亦可以指安装在非Mac电脑上的macOS。对于这个词的确切定义还是模糊不清的，不过这不是关键所在。与黑苹果相对，白苹果的含义就非常明显了，也就是苹果的Mac或者安装在Mac上的macOS。

黑苹果的原理就是通过对电脑主板的破解和对系统的欺骗，让macOS以为这是一台Mac，再通过一系列驱动和补丁使得这台电脑可以在macOS下正常运行。需要注意的是：

<font size=4>**将macOS安装在非Mac的电脑上是违反苹果公司的法律条款的！**</font>

所以安装黑苹果是存在一定的法律风险的，这有可能（但是非常非常罕见）导致你的AppleID被锁死。但是一般情况下，苹果公司对这种行为都是睁一只眼闭一只眼。只是随着黑苹果数量上的日益增长，不知道什么时候会引起苹果公司的重视并对此采取措施。而在另一方面，如果你使用黑苹果来牟利的话，性质就完全不同了，你有可能会受到法律的制裁。

由于macOS从一开始就不被允许安装在非Mac的电脑上，因此安装黑苹果绝对不是一件容易的事情，它涉及到对主板的破解，对硬件的驱动，对系统的欺骗，同时也会产生很多奇奇怪怪的bug。黑苹果有很多缺点：

- 不完美的黑苹果相对于白苹果不那么稳定
- 黑苹果在硬件层面上的缺失导致很多功能无法实现，如Touch Bar，Touch ID，力度触控板等
- 安装黑苹果仍需要满足一定的硬件条件，某些型号的硬件在黑苹果下是无法驱动的
- 安装黑苹果费时费力，相当折腾

既然黑苹果有那么多缺点，并且还是非法的行为，那为什么还有那么多人在使用黑苹果并且人数还在日益增长呢？因为黑苹果与同样安装有macOS的电脑相比，还是有其优点的：

- 完美的黑苹果在使用体验上完全不输给Mac

- 黑苹果在同等硬件或性能条件下比起Mac便宜许多
- 黑苹果的定制性和可扩展性在某些方面比Mac强大许多

从黑苹果的优点来看，再结合实际情况，我们可以发现使用黑苹果的人群可以分为以下几类：

- 对macOS有刚需，但是又不想花钱/没钱买Mac的，如某些影视、音乐工作者
- 对macOS有刚需，但是受限于苹果封闭的生态，只能通过黑苹果的高可扩展性来满足自己对硬件的需求的特定行业从业者
- 对macOS没有刚需，具有反叛精神的极客，专门研究操作系统和硬件的工程师，通常这类人也有白苹果
- 对macOS没有刚需，只是想要体验macOS或苹果完整生态却又不想花钱/没钱购买Mac的人

而博主作为一个穷学生，就是属于最后一类的人😂。我折腾黑苹果已经有1年时间，现在自己在用的电脑是惠普的`Envy-13 ad024TU`，装有Windows和macOS两个系统。博主的黑苹果已经基本完美，在使用体验上已经与白苹果相差无几。关于我的黑苹果的更多信息，可以参考我的[Github仓库](https://github.com/Astrobr/HackintoshForEnvy13-ad0xx)，或者我的[另一篇博客](https://astrobear.top/2020/02/14/HP_Envy-13_ad024TU_Hackintosh/)，在那篇博客里我主要总结了给自己的电脑安装黑苹果时踩过的一些坑。而这篇文章主要是让大家对黑苹果有一个初步的了解。看完这篇文章，你就基本入门黑苹果了。

### 黑苹果的原理以及核心

#### 黑苹果的原理

在讨论这个问题以前，我们先要了解一下电脑是怎么启动的。

首先，在你按下开机键以后，电脑上电，各硬件进入了待命状态。CPU（**C**entral **P**rocessing **U**nit，中央处理器）启动以后，按照其在设计时就固定好的功能送出了第一条指令，这一条指令将会使BIOS（**B**asic **I**nput/**O**utput **S**ystem，基本输入输出系统）芯片中装载的程序开始执行。BIOS程序可以实现很多功能，比如系统自检，提供中断服务等。但是它最主要的功能则是将存放于硬盘引导区的操作系统引导程序（Boot loader，下文简称引导）装载入内存，再通过引导将操作系统装载进内存。

当然，现在市面上新发售的电脑大部分都已经采用了一种更新的方式来装载引导，也就是所谓的UEFI（Unified Extensible Firmware Interface，统一可扩部件接口）。UEFI作为一种较新的方案，它和BIOS的区别主要是在可扩展性方面。但是除了一些细微的差别，它在整个启动的流程上与BIOS基本相同，且最终目的都是将引导装载进内存当中。另外在开发者圈子中，BIOS和UEFI也常常被混为一谈。因此尽管现在的主流是采用更先进的UEFI，但在下面的叙述中我还是会使用BIOS的概念。这并不会给理解带来困难，只是你们需要知道这两者有些许微妙的区别即可。

也许有人会问，为什么不使用BIOS直接将操作系统装载进内存呢？首先，如果有多个操作系统，那么不同的操作系统的装载过程会有所不同。如果要让BIOS适配不同的操作系统，那么会导致它的体积过于庞大，系统过于复杂，不利于它的的稳定。其次就是，BIOS是固定在BIOS芯片中的，不方便修改。这也导致了我们难以让BIOS对不同的操作系统做适配。因此，我们需要引导来完成操作系统加载的工作。

具体而言，引导需要完成的工作主要有以下几点：

- 初始化其他硬件设备，为系统提供可访问的表和服务
- 为操作系统分配内存空间，再将它加载进内存当中
- 为高级计算机程序语言提供执行环境
- 将控制权移交给操作系统

在此之后，系统的完整的启动过程就结束了，操作系统接管了整个电脑。简而言之，电脑的启动过程可以概括为：`BIOS->Bootloder->OS(操作系统)`。

回到黑苹果上来。我们想要在一款非Mac的电脑上运行macOS，与我们在电脑上运行Windows的最大区别在哪儿？当然是操作系统不同啊！由于macOS与Windows是两个完全不同的操作系统，因此他们启动和加载的过程也完全不同。所以我们肯定不可以用启动Windows的那一套方法去启动macOS，而必须要有专门的适应macOS的一套启动方法（程序）。

我们想要将macOS加载到我们的内存当中，就要对当前我们的启动程序进行修改和适配。回顾上文所说的电脑的启动过程我们可以发现，BIOS是固定在芯片中的，不易修改。那么我们可以操作的部分就只有引导了。所以我们要找到合适的引导程序，使其可以将macOS正确地装载进内存，并给它提供正确的服务，让它可以与硬件正常交流，最终使它正常运行。

通过上面的一番讲解，我们可以发现，安装黑苹果的核心就是引导。而实际上，折腾黑苹果折腾的也主要就是引导。而由于白苹果的硬件，BIOS，和引导都是针对macOS开发的，所以当然不要任何的折腾，开箱即用就行（废话......）。

目前主流的可以用于在非Mac的电脑上启动macOS的引导主要有两个，分别是`Clover`和`OpenCore`（下文简称OC）。由于OC是新开发的引导，目前还在公测阶段，而且其在社区普及率远远不如Clover，所以下面将主要讲解Clover，而对于OC只作非常简单的介绍。

#### Clover

> 启动器的名字`Clover`由一位创建者kabyl命名。他发现了四叶草和Mac键盘上Commmand键（⌘）的相似之处，由此起了Clover这个名字。四叶草是三叶草的稀有变种。根据西方传统，发现者四叶草意味的是好运，尤其是偶然发现的，更是祥瑞之兆。另外，第一片叶子代表信仰，第二片叶子代表希望，第三片叶子代表爱情，第四片叶子代表运气。——摘自维基百科

Clover是一个操作系统引导程序，可以通过新老两种方式进行启动，也就是BIOS方式和UEFI方式。目前主流的操作系统都已经是通过UEFI方式启动的了，如macOS，Windows 7/8/10 (64-bit)，Linux。

引导都是放在电脑硬盘开头部分的引导区的EFI文件夹中，Clover也不例外。下面就来看看Clover的文件结构。

![重要的文件夹和其功能在图中以方框和文字注明]()

在Clover下使用UEFI方式启动的流程是这样的：`UEFI->CLOVERX64.efi->OS`。

下面我将主要根据在实际操作中用到的一些功能来介绍Clover。

- 进入操作系统

  这一步非常简单，开机之后用方向键选择你需要进入的操作系统，按下回车即可。

  ![图中出现了三种不同系统的图标(Credit: daliansky)](http://7.daliansky.net/1-main.png)

- 显示帮助

  按下`F1`键会出现帮助信息。

  ![帮助信息(Credit: daliansky)](http://7.daliansky.net/Help_F11.png)

- 更新Clover

  请在[这里](https://github.com/Dids/clover-builder/releases)下载最新版本的`CLOVERX64.efi`并使用它替换掉你的EFI文件夹中的Clover文件夹中的同名文件。

- 开启啰嗦模式启动

  首先我要介绍一下什么是啰嗦模式。一般来说，我们在启动系统的时候只能看到一个进度条或者旋转的表示加载中的图案。而啰嗦模式就是将系统启动时各种详细参数和日志以及报错信息全部显示出来的模式，如下图所示。如果发生了操作系统启动异常/失败的情况，通过开启啰嗦模式，我们可以快速定位到出错的位置。

  开启啰嗦模式的方法很简单。首先选择你想要进入的系统的图标，按空格即可进入下图所示的页面，然后勾选图示选项，再选择`Boot macOS with selected options`启动。

  ![开启啰嗦模式(Credit: daliansky)](http://7.daliansky.net/space-selected.png)

- 显示隐藏的卷标

  有的时候在Clover的启动页面中会出现很多以不同方式启动同一系统的卷标（Volume，可以理解为入口），我们可以通过修改Clover的配置文件来隐藏这些卷标，但是有的时候你又需要它们显示出来（比如你要通过进入`Recovery`卷标来关闭macOS的系统完整性保护的时候）。这个时候我们不必重新修改配置文件，只需要在Clover的主界面按下`F3`，即可将隐藏的卷标显示出来。

  关于怎么隐藏卷标，我将在下面介绍。

- 提取DSDT

  DSDT的全称为 **D**ifferentiated **S**ystem **D**escription **T**able，它是一个描述系统硬件不同信息的表，通过查阅这个表中的信息可以知道你的电脑有什么硬件，它们的名称是什么。知道这些信息有利于我们理顺硬件之间的关系，再通过修改补丁更正硬件信息，以优化操作系统的工作状况。

  在Clover主界面下按`F4`即可将你的DSDT信息保存到`EFI/CLOVER/ACPI/origin/`文件夹中。请注意，DSDT是由多个文件组成的。

- 选择你想要启用/禁用的驱动程序

  通过Clover加载的驱动程序保存在`EFI/CLOVER/kexts/Other`中，这些驱动程序是针对macOS生效的。在上面所说的那个文件夹中包含了很多不同的驱动文件，有些驱动文件之间会产生冲突，而有些驱动文件又是完全没有必要存在的。为了管理和精简你的驱动程序，你可以在Clover中设置你想要禁用的驱动程序以排查各种驱动的工作状况。

  首先你要选择macOS的图标，按下空格键。然后在新的页面中将光标移动到`Block injected kexts`，按下回车后进入该选项。再在新的页面中选择`Other`选项，这个时候你就可以看到你的驱动程序了。勾选你想要禁用的驱动程序以后，按`Esc`回到主页面，再直接回车进入macOS。

  ![选择你想要禁用的驱动程序(Credit: daliansky)](http://7.daliansky.net/BIKChoose.png)

  请注意，你的这一设置只对这一次启动有效，在之后的启动中将不会保留。

- 设置Clover（修改`config.plist`）

  这个操作有多种方法。

  - 你可以在开机以后的Clover主界面下按下按键`O`进入设置页面，然后你就可以选择不同的选项开始修改你的配置文件了。一般情况下我们不会使用这种方式来修改。

    ![Clover的设置页面(Credit: daliansky)](http://7.daliansky.net/options.png)

  - 你可以使用Clover Configurator来修改。Clover Configurator是一款运行在macOS下的应用程序，专门用来修改Clover的配置文件。它具有友好的图形化界面，每个选项都有比较详细的功能说明，操作起来比在启动时修改要轻松得多。Clover Configurator的下载链接放在文末。

    在设置以前，你需要在Clover Configurator的`挂载分区`选项卡中挂载你EFI分区（通常情况下这个分区都是隐藏的）。然后在你的Clover文件夹下使用Clover Configurator打开`config.plist`文件，进行修改。修改完成以后，请点击左下角的保存图标（图中以红框标明）。

    ![挂载EFI分区，点击挂载以后需要输入你的开机密码]()

    ![Clover Configurator的设置界面]()

  - 你还可以使用普通的文本文档编辑器（如Xcode或者Visual Studio Code）打开`config.plist`对其进行编辑。但是这个方法不够直观，不推荐新手或者代码小白这样操作。

    ![在Visual Studio Code中打开的Clover配置文件]()

- 增加/删除/修改/查找驱动程序

  在启动以后，你可以使用Clover Configurator挂载EFI分区，然后直接使用访达在驱动文件夹中以可视化的方式管理你的驱动程序。

  当然，你也可以使用Disk Genius在Windows下管理你的驱动程序。在下一章节中有关于Disk Genius的更多介绍。

- 更换Clover的主题

  Clover提供了很多自定义功能，你可以选择自己喜欢的Clover开机主题。Clover的主题存放在`EFI/CLOVER/themes/`文件夹中，你可以下载你喜欢的主题文件夹并将其保存到上述路径中。然后，你需要在Clover Configurator中的`引导界面`选项卡中填写你想要设置的主题文件夹的名字（如下图）并保存。

  ![修改Clover主题]()

  博主目前用的是一款名为`Simple`的主题，可以点击[此处](https://github.com/burpsuite/clover_theme)下载。在GitHub上还有很多不同的Clover主题可供选择。

  ![博主正在使用的Simple主题]()

- 隐藏你不需要的卷标

  如果你的Clover启动界面有很多引导同一系统的卷标，你可以将他们隐藏起来。具体方法是，Clover Configurator中的`引导界面`选项卡中的`隐藏卷`一栏中填写你想要隐藏的卷标的名称，然后保存文件。

  ![隐藏你不需要的卷标]()

Clover的主要功能就介绍到这里了。由于本文是纯粹的新手向，在这里就不介绍如何配置`config.plist`了。一般来说，只要你能够找到完全对应你机型的EFI文件，基本上就不需要再重新配置Clover了。下面，我们再简单介绍一下新时代的引导工具：OpenCore。

#### OpenCore

OpenCore是一个着眼于未来的先进的开源引导工具，他支持多种主流操作系统的引导。OC的历史使命就是有朝一日代替Clover，成为主流。OC主要有以下几个优势：

- 从 2019 年 9 月以后, Acidanthera（神级大佬，黑苹果现有的大部分驱动目前都是他在开发管理）开发的内核驱动 （Lilu, AppleALC 等）将**不再会**在 Clover 上做兼容性测试（虽然这不能算是优势，但是很关键好吗！）
- OC的安全性更好，对文件保险箱（FileVault）有更强大的支持
- OC使用更先进的方法注入第三方内核驱动（也就是你`EFI/CLOVER/kexts/Other`里面的那些`kext`文件）
- OC在启动体验上会更加接近白苹果

当然，为什么现在OC还未能成为主流，首先是因为它还处于开发阶段，各方面还未达到最成熟的状态；其次是因为OC的配置相对于Clover要复杂许多，而且目前没有像Clover Configurator一样直观的图形化界面的配置工具；最后是因为，OC在社区中普及程度不高，导致遇到问题很难找到现成的案例解决。这些原因使很多人放弃了折腾。但是历史的发展是一个螺旋上升的过程，未来将一定是OC的！（笑）

### 黑苹果的初步安装

讨论完了黑苹果的原理以及核心，下一步就该讲讲如何安装了！但是请大家注意，因为这篇文章主要是面向新手的，所以我只会介绍一些最最基本和通用的操作，目的是为了让大家先把黑苹果装上。而安装完成以后的那些各种优化的操作，包括配置Clover的配置文件，给系统打补丁等定制性比较强的内容，都**不会**在本文中涉及。博主可能在接下来一段很长的时间内陆陆续续更新一些系统优化的内容，敬请期待！闲话少说，我们开始吧！

#### 制作安装盘

#### 磁盘分区

#### 替换EFI文件

#### 设置BIOS

#### 安装系统

#### 脱离U盘启动

### 黑苹果的后期完善

#### 硬件检查

#### 常见问题

### 黑苹果相关资源推荐

#### 黑苹果相关网站

#### 黑苹果软件、驱动资源



### 声明与致谢

黑苹果社区的健康需要大家共同维护，恳请新人们注意以下几点：

- 不要把社区的成果（如各种机型的EFI，开源软件等）拿来作商业用途
- 不要购买淘宝上面的EFI！所有现存的EFI都可以在网上免费获得！请不要支持那些兜售EFI的无良商家，他们也是从网上下载的
- 不建议去淘宝上购买安装黑苹果的服务，出了问题到最后还是要你自己解决
- 不建议把自己的折腾成果在网络上有偿提供，这样并不利于社区的发展
- 网友没有义务去无偿地帮你解决问题，另外也请善用搜索引擎

黑苹果一开始是极客的产物，是反叛精神的象征。令人意料不到的是，现在它居然可以为我们普通人所用。而从极客到大众的过渡，黑苹果的开源社区对此作出了极大贡献。对那些对社区做出过极大贡献的极客和工程师们，对社区建设贡献出自己的一份力量、努力维护社区健康发展的成员，我向你们表达最诚挚的感谢。没有社区，就没有黑苹果的今天。作为从社区中获益的普通成员，也应该通过自己的努力，以自己的方式去回馈这个社区，帮助它更好地发展。

博主在此谨向你们表达我的感谢：[RehabMan](https://github.com/RehabMan)，[Acidanthera](https://github.com/acidanthera)，[黑果小兵](https://blog.daliansky.net)，[SlientSliver](https://github.com/SilentSliver)，[IT密码](https://www.itpwd.com)，以及其他给予过我帮助的网友或开发者们😘。